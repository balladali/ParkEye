# ParkEye

Сервис для определения наличия свободных мест на парковке с использованием компьютерного зрения.

## Описание

ParkEye анализирует видеопоток с камеры и определяет, есть ли свободные места на парковке. Система использует алгоритмы компьютерного зрения и машинного обучения для распознавания автомобилей и свободных мест.

## Структура проекта

- `src/camera.py` - модуль для работы с камерой и получения изображений
- `src/detector.py` - модуль для обработки изображений и определения свободных мест
- `src/service.py` - основной сервис, объединяющий функциональность модулей
- `src/config.py` - файл конфигурации
- `src/utils.py` - вспомогательные утилиты, включая инструмент для разметки парковочных мест
- `main.py` - точка входа в приложение

## Особенности

- Определение свободных парковочных мест в реальном времени
- Анализ одиночных изображений
- Пакетная обработка нескольких изображений
- Возможность разметки парковочных мест через графический интерфейс
- Поддержка русского текста при выводе информации на изображения
- **Специальный зимний режим для заснеженных парковок**

## Использование

### Основной режим (видеопоток с камеры)
```
python main.py
```

### Анализ одиночного изображения
```
python main.py --image путь/к/изображению.jpg --save результат.jpg
```

### Пакетная обработка изображений
```
python main.py --batch "изображения/*.jpg" --output-dir результаты
```

### Разметка парковочных мест
```
python main.py --mark-spots путь/к/изображению.jpg --spots-config конфигурация.json
```

### Зимний режим для заснеженных парковок
```
python main.py --image заснеженная_парковка.jpg --winter --save результат.jpg
```

## Зимний режим для заснеженных парковок

Система ParkEye включает специальный режим для работы с заснеженными парковками, который можно активировать добавлением аргумента `--winter` к команде. Также система может автоматически определить наличие снега на изображении и включить этот режим.

### Особенности зимнего режима:

1. **Автоматическое определение снега** - система анализирует изображение на наличие большого количества белых пикселей, характерных для снега
   
2. **Улучшение контраста** - к изображению применяется адаптивное выравнивание гистограммы (CLAHE), что позволяет выделить автомобили на заснеженном фоне
   
3. **Измененные пороги обнаружения** - используются специальные, более низкие пороги для определения занятости мест
   
4. **Дополнительный анализ цветов** - система выделяет нетипичные для снега цвета, что помогает обнаружить автомобили на белом фоне
   
5. **Настраиваемые параметры в config.py** - все параметры зимнего режима можно настроить в файле конфигурации

### Настройка параметров зимнего режима

В файле `src/config.py` можно настроить следующие параметры:

```python
# Настройки для зимнего режима
WINTER_OCCUPANCY_THRESHOLD = 0.15  # Порог для зимнего режима
SNOW_DETECTION_THRESHOLD = 0.3     # Доля белых пикселей для определения снега
# Веса признаков для зимнего режима
WINTER_WEIGHTS = {
    'edge_density': 0.20,     # Плотность краев
    'thresh_density': 0.15,   # Плотность объектов
    'std_dev': 0.20,          # Вариация яркости
    'gradient_mean': 0.15,    # Средний градиент
    'color_var': 0.10,        # Вариация цветов
    'color_density': 0.20     # Плотность нетипичных для снега цветов
}
```